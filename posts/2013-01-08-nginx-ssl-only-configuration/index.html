<!doctype html><html lang=en><head><title>nginx ssl only configuration ::
acode.ninja — Adventures of a code ninja</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Configuring Nginx with SSL can be a bit of a nightmare to do properly. Here is a handy config file I use as a starting base for it.
#HTTP Redirect server { # Set up the port listener  listen 80; listen [IPV6]:80 default ipv6only=on; # Set the hostname to be served  server_name SITE www.SITE; # Set up access and error logs  accesslog /var/www/SITE/logs/nginx.access.log; errorlog /var/www/SITE/logs/nginx.error.log; # Redirect all requests on http to https  location / { rewrite ^ https://$servername$requesturi?"><meta name=keywords content="software developer,coder,learning to code"><meta name=robots content="noodp"><link rel=canonical href=/posts/2013-01-08-nginx-ssl-only-configuration/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="nginx ssl only configuration"><meta name=twitter:description content="Configuring Nginx with SSL can be a bit of a nightmare to do properly. Here is a handy config file I use as a starting base for it.
#HTTP Redirect server { # Set up the port listener  listen 80; listen [IPV6]:80 default ipv6only=on; # Set the hostname to be served  server_name SITE www.SITE; # Set up access and error logs  accesslog /var/www/SITE/logs/nginx.access.log; errorlog /var/www/SITE/logs/nginx.error.log; # Redirect all requests on http to https  location / { rewrite ^ https://$servername$requesturi?"><meta property="og:title" content="nginx ssl only configuration"><meta property="og:description" content="Configuring Nginx with SSL can be a bit of a nightmare to do properly. Here is a handy config file I use as a starting base for it.
#HTTP Redirect server { # Set up the port listener  listen 80; listen [IPV6]:80 default ipv6only=on; # Set the hostname to be served  server_name SITE www.SITE; # Set up access and error logs  accesslog /var/www/SITE/logs/nginx.access.log; errorlog /var/www/SITE/logs/nginx.error.log; # Redirect all requests on http to https  location / { rewrite ^ https://$servername$requesturi?"><meta property="og:type" content="article"><meta property="og:url" content="/posts/2013-01-08-nginx-ssl-only-configuration/"><meta property="article:published_time" content="2013-01-08T00:00:00+00:00"><meta property="article:modified_time" content="2013-01-08T00:00:00+00:00"><meta property="og:site_name" content="acode.ninja"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>acode.ninja</span>
<span class=logo__cursor></span></a><span class=header__right><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>nginx ssl only configuration</h1><div class=post-meta><span class=post-date>2013-01-08</span>
<span class=post-read-time>— 2 min read</span></div><div class=post-content><p>Configuring Nginx with SSL can be a bit of a nightmare to do properly.
Here is a handy config file I use as a starting base for it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#75715e>#HTTP Redirect
</span><span style=color:#75715e></span><span style=color:#66d9ef>server</span> {
    <span style=color:#75715e># Set up the port listener
</span><span style=color:#75715e></span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>; 
    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[IPV6]:80</span> <span style=color:#e6db74>default</span> <span style=color:#e6db74>ipv6only=on</span>;
    
    <span style=color:#75715e># Set the hostname to be served
</span><span style=color:#75715e></span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>SITE</span> <span style=color:#e6db74>www.SITE</span>;

    <span style=color:#75715e># Set up access and error logs
</span><span style=color:#75715e></span>    <span style=color:#f92672>accesslog</span> <span style=color:#e6db74>/var/www/SITE/logs/nginx.access.log</span>;
    <span style=color:#f92672>errorlog</span> <span style=color:#e6db74>/var/www/SITE/logs/nginx.error.log</span>;

    <span style=color:#75715e># Redirect all requests on http to https
</span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
        <span style=color:#f92672>rewrite</span> <span style=color:#e6db74>^</span> <span style=color:#e6db74>https://</span>$servername$requesturi? <span style=color:#e6db74>permanent</span>;
    }
}

<span style=color:#66d9ef>HTTPS</span>
<span style=color:#e6db74>server</span> {

    <span style=color:#75715e># Set up the port listener
</span><span style=color:#75715e></span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span>;
    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[IPv6]:443</span> <span style=color:#e6db74>default</span> <span style=color:#e6db74>ipv6only=on</span>;

    <span style=color:#75715e># Set the hostname to be served
</span><span style=color:#75715e></span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>SITE</span> <span style=color:#e6db74>www.SITE</span>;

    <span style=color:#75715e># Set up SSL
</span><span style=color:#75715e></span>    <span style=color:#f92672>ssl</span> <span style=color:#66d9ef>on</span>;
    <span style=color:#f92672>sslcertificate</span> <span style=color:#e6db74>/var/www/SITE/certs/ssl.crt</span>;
    <span style=color:#f92672>sslcertificatekey</span> <span style=color:#e6db74>/var/www/SITE/certs/ssl.key</span>;
    <span style=color:#f92672>sslsessiontimeout</span> <span style=color:#ae81ff>5m</span>;
    <span style=color:#f92672>sslpreferserverciphers</span> <span style=color:#66d9ef>on</span>;
    
    <span style=color:#75715e># Set up access and error logs
</span><span style=color:#75715e></span>    <span style=color:#f92672>accesslog</span> <span style=color:#e6db74>/var/www/SITE/logs/nginx.access.log</span>;
    <span style=color:#f92672>errorlog</span> <span style=color:#e6db74>/var/www/SITE/logs/nginx.error.log</span>;
    
    <span style=color:#75715e># Set up the root of public html folders 
</span><span style=color:#75715e></span>    <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/SITE/www</span>; 
    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.php</span> <span style=color:#e6db74>index.htm</span> <span style=color:#e6db74>index.html</span>;

    <span style=color:#75715e># Set up the php system 
</span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> ~ <span style=color:#e6db74>.php$</span> {
        <span style=color:#f92672>fastcgipass</span> 127.0.0.1:<span style=color:#ae81ff>9000</span>; 
        <span style=color:#f92672>fastcgiindex</span> <span style=color:#e6db74>index.php</span>; 
        <span style=color:#f92672>fastcgiparam</span> <span style=color:#e6db74>SCRIPTFILENAME</span> <span style=color:#e6db74>/var/www/SITE/www</span>$fastcgiscriptname; 
        <span style=color:#f92672>include</span> <span style=color:#e6db74>fastcgi_params</span>;
    }
} 
</code></pre></div><p>Looking through the config file you can see a number of parts, the two most
important parts are as follows:</p><ul><li>rewrite ^ https://$server_name$request_uri? permanent; This allows any
requests made to the http service to be redirected to the https</li><li>ssl on; This tells the server to use SSL on port 443 to server https
encrypted pages.</li></ul><p>I hope that this short article helps get you up and running with SSL on Nginx.</p></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user">Lawrence Goldstien</div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>